# tasks file for supervisor
---
- name: programs | update program configuration files (present)
  template:
    src: etc/supervisor/conf.d/program.conf.j2
    dest: "/etc/supervisor/conf.d/{{ item.key }}.conf"
    owner: "{{ supervisor_system_user }}"
    group: "{{ supervisor_system_group }}"
    mode: 0640
  with_dict: "{{ supervisor_programs_present }}"
  notify:
    - force-stop supervisor
    - wait 3 seconds
    - stop supervisor
    - start supervisor
  tags:
    - supervisor-programs-present

- name: programs | update program configuration files (absent)
  file:
    path: "/etc/supervisor/conf.d/{{ item.key }}.conf"
    state: absent
  with_dict: "{{ supervisor_programs_absent }}"
  notify:
    - force-stop supervisor
    - wait 3 seconds
    - stop supervisor
    - start supervisor
  tags:
    - supervisor-programs-absent
